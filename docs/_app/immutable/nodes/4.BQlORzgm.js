var Ye=Object.defineProperty;var Fe=(m,d,e)=>d in m?Ye(m,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[d]=e;var v=(m,d,e)=>Fe(m,typeof d!="symbol"?d+"":d,e);import{t as N,a as E,d as Ge,c as He}from"../chunks/BPIe10jS.js";import{p as he,a0 as le,u as U,f as W,t as j,a as Ie,s as $,_ as x,g as c,$ as _,c as ce,q as Je}from"../chunks/Dpyf6PEV.js";import{D as u,e as X,i as Z,c as Ke,b as Qe,I as Ue,s as We}from"../chunks/CW5lENDL.js";import{w as D,d as p,r as Xe,g as ue}from"../chunks/CexFCLEt.js";import{d as Ze,s as A}from"../chunks/CF3KxQVy.js";import{p as ve,i as k}from"../chunks/C2D6hrGJ.js";import{r as et,a as me}from"../chunks/Cipv_3Pu.js";import{s as b,a as tt}from"../chunks/CGQ5YzU4.js";const rt=({params:m})=>{console.log(m);const{id:d}=m,e=Number(d);return console.log(e),{recipeId:e}},Et=Object.freeze(Object.defineProperty({__proto__:null,load:rt},Symbol.toStringTag,{value:"Module"}));class st{constructor(d,e,t,n){this.recipeId=d,this.itemId=e,this.targetAmount=t,this.targetInterval=n}}const ee=(m,d)=>{const e={...m};return Object.entries(d).forEach(([t,n])=>{const r=Number(t);e[r]=n}),e};class te extends st{constructor(e,t,n,r){var M;const s=!!(t&&(u.canBeExtracted[t]||u.canBeMined[t]));!e&&!s&&(e=(M=u.alternativeRecipe[t])==null?void 0:M[0]);const a=D(e),i=e?u.recipe[e]:void 0;let g=i==null?void 0:i.Results.findIndex(w=>t===w);const y=!t;!t&&(g??-1)>=0&&(t=i==null?void 0:i.Results[g??0]);const B=D(t),R=D((i==null?void 0:i.ResultCounts[g??0])??1),V=n?p([B,n],([w,z])=>z[w]):R;r||(r=Xe(i==null?void 0:i.TimeSpend));super(a,B,V,r);v(this,"amountEditable");v(this,"manualAmount",D());v(this,"children",D([]));v(this,"canBeMined",p(this.itemId,e=>u.canBeMined[e]));v(this,"canBeExtracted",p(this.itemId,e=>u.canBeExtracted[e]));v(this,"item",p(this.itemId,e=>u.item[e]));v(this,"recipe",p(this.recipeId,e=>u.recipe[e]));v(this,"options",p(this.itemId,e=>u.alternativeRecipe[e]));v(this,"relativeSpeed",p([this.targetInterval,this.recipe],([e,t])=>e/(t==null?void 0:t.TimeSpend)));v(this,"requiredBuildings",p([this.targetAmount,this.recipe,this.itemId,this.relativeSpeed],([e,t,n,r])=>{const s=t==null?void 0:t.Results.findIndex(i=>n===i),a=e/(t==null?void 0:t.ResultCounts[s])/r;return isNaN(a)?e:a}));v(this,"providedItemsPerInterval",p([this.recipe,this.relativeSpeed,this.requiredBuildings,this.itemId,this.targetAmount],([e,t,n,r,s])=>{if(!e&&r)return{[r]:s};const a={};return e==null||e.Results.forEach((i,g)=>{a[i]=e.ResultCounts[g]*t*n}),a}));v(this,"childrenProvideItemsPerInterval",p(this.children,(e,t)=>{const n=new Array(e.length),r=e.map((a,i)=>a.providedItemsPerInterval.subscribe(g=>{n[i]=g;const y=n.filter(B=>!!B).reduce((B,R)=>ee(B,R),{});t(y)})),s=n.filter(a=>!!a).reduce((a,i)=>ee(a,i),{});return t(s),()=>r.forEach(a=>a())}));v(this,"requiredItemsPerInterval",p([this.recipe,this.relativeSpeed,this.requiredBuildings],([e,t,n])=>{const r={};return e==null||e.Items.forEach((s,a)=>r[s]=e.ItemCounts[a]*t*n),r}));v(this,"inputsOutputs",p([this.childrenProvideItemsPerInterval,this.requiredItemsPerInterval,this.providedItemsPerInterval],([e,t,n])=>{const r=new Set;return Object.keys(t).forEach(s=>{r.add(Number(s))}),Object.keys(e??{}).forEach(s=>{r.add(Number(s))}),Object.keys(n).forEach(s=>{r.add(Number(s))}),r}));v(this,"surplus",p([this.childrenProvideItemsPerInterval,this.requiredItemsPerInterval,this.providedItemsPerInterval,this.itemId],([e,t,n,r])=>{const s=ee(e,n);return Object.entries(t).forEach(([a,i])=>s[Number(a)]=(s[Number(a)]??0)-i),Object.entries(s).filter(([,a])=>a<=0).forEach(([a])=>delete s[Number(a)]),s}));v(this,"deficit",p([this.childrenProvideItemsPerInterval,this.requiredItemsPerInterval],([e,t])=>{const n={...e};return Object.entries(t).forEach(([r,s])=>n[Number(r)]=(n[Number(r)]??0)-s),Object.entries(n).filter(([,r])=>r>=0).forEach(([r])=>delete n[Number(r)]),Object.keys(n).forEach(r=>{var a;const s=Number(r);(a=u.producedVia[s])!=null&&a.length||delete n[s]}),n}));v(this,"totals",p([this.itemId,this.requiredBuildings,this.children],([e,t,n])=>{const r={};return r[e]=t,n.map(s=>s.totals).forEach(s=>{Object.entries(s).forEach(([a,i])=>{const g=Number(a);r[g]=(r[g]??0)+i})}),r}));this.amountEditable=y,this.manualAmount=R,n||this.children.set(this.dbd())}setAmount(e){this.manualAmount.set(e)}setRecipeId(e){this.recipeId.set(e),this.expand()}expand(){this.children.set(this.dbd())}dbd(){const e=[],t=ue(this.recipe);return t==null||t.Items.forEach((n,r)=>{var i;if(!((i=u.alternativeRecipe[n])!=null&&i.length))return;const s=new te(void 0,n,this.requiredItemsPerInterval,this.targetInterval);e.push(s);const a=ue(s.providedItemsPerInterval);Object.entries(a).forEach(([g,y])=>{})}),e}}var nt=N('<input type="number" class="w-12 text-right">'),at=N("<span> </span>"),it=N("<option>extraction/mining</option>"),ot=N("<option> </option>"),dt=N(" <select><!><!></select>",1),lt=N('<span class="flex-grow text-right w-12"> </span>'),ct=N("<li> <!> </li>"),ut=(m,d)=>d.planner.expand(),vt=N("<button>DRILL BABY DRILL</button>"),mt=N('<div class="flex gap-2 max-w-2xl"><div><!></div> <div><h5><!></h5></div> <span> </span> <!></div> <div class="ml-4"><div class="ml-4"></div></div> <div class="ml-4"><ul class="ml-4"><!> <!></ul></div>',1);function fe(m,d){he(d,!0);const[e,t]=tt(),n=()=>b($e,"$targetAmount",e),r=()=>b(re,"$recipeId",e),s=()=>b(be,"$itemId",e),a=()=>b(Ae,"$options",e),i=()=>b(_e,"$item",e),g=()=>b(ge,"$recipe",e),y=()=>b(xe,"$targetInterval",e),B=()=>b(Pe,"$requiredBuildings",e),R=()=>b(Ee,"$children",e),V=()=>b(qe,"$inputsOutputs",e),M=()=>b(Oe,"$providedItemsPerInterval",e),w=()=>b(Be,"$childrenProvideItemsPerInterval",e),z=()=>b(Ne,"$requiredItemsPerInterval",e),pe=()=>b(je,"$deficit",e);let{item:_e,itemId:be,recipe:ge,recipeId:re,targetInterval:xe,requiredBuildings:Pe,children:Ee,targetAmount:$e,childrenProvideItemsPerInterval:Be,providedItemsPerInterval:Oe,requiredItemsPerInterval:Ne,inputsOutputs:qe,deficit:je,options:Ae}=d.planner,C=le(ve(n())),L=le(ve(r()));U(()=>{d.planner.amountEditable&&n()!==c(C)&&d.planner.setAmount(c(C))}),U(()=>{c(L)!==r()&&d.planner.setRecipeId(c(L))}),U(()=>{console.log(r())});var se=mt(),Y=W(se),F=x(Y),ye=x(F);{var Re=l=>{var o=nt();et(o),Ke(o,()=>c(C),I=>ce(C,I)),E(l,o)},ke=l=>{var o=at(),I=x(o,!0);_(o),j(()=>A(I,n())),E(l,o)};k(ye,l=>{d.planner.amountEditable?l(Re):l(ke,!1)})}_(F);var G=$(F,2),ne=x(G),we=x(ne);{var Se=l=>{var o=dt(),I=W(o),P=$(I),T=x(P);{var K=f=>{var h=it();h.value=(h.__value=void 0)==null?"":void 0,j(()=>me(h,r()===void 0)),E(f,h)};k(T,f=>{(u.canBeExtracted[s()]||u.canBeMined[s()])&&f(K)})}var q=$(T);X(q,1,a,Z,(f,h)=>{var O=ot(),S={},Q=x(O,!0);_(O),j(()=>{S!==(S=u.recipe[c(h)].ID)&&(O.value=(O.__value=u.recipe[c(h)].ID)==null?"":u.recipe[c(h)].ID),me(O,re===u.recipe[c(h)].ID),A(Q,u.recipe[c(h)].Name)}),E(f,O)}),_(P),j(()=>A(I,`${i().Name??""}: `)),Qe(P,()=>c(L),f=>ce(L,f)),E(l,o)},De=l=>{var o=Ge();j(()=>{var I;return A(o,(I=g())==null?void 0:I.Name)}),E(l,o)};k(we,l=>{s()&&(a().length>1||a().length>=1&&u.canBeExtracted[s()]||u.canBeMined[s()])?l(Se):l(De,!1)})}_(ne),_(G);var H=$(G,2),Me=x(H);_(H);var Ce=$(H,2);{var Le=l=>{var o=lt(),I=x(o,!0);_(o),j(P=>A(I,P),[()=>Math.round(B()*100)/100]),E(l,o)};k(Ce,l=>{B()&&r()&&l(Le)})}_(Y);var J=$(Y,2),ae=x(J);X(ae,5,R,Z,(l,o,I,P)=>{fe(l,{get planner(){return c(o)}})}),_(ae),_(J);var ie=$(J,2),oe=x(ie),de=x(oe);X(de,1,V,Z,(l,o)=>{var I=He();const P=Je(()=>{var q,f,h;return(((q=M())==null?void 0:q[c(o)])??0)+(((f=w())==null?void 0:f[c(o)])??0)-(((h=z())==null?void 0:h[c(o)])??0)});var T=W(I);{var K=q=>{var f=ct();let h;var O=x(f),S=$(O);Ue(S,{get itemId(){return c(o)}});var Q=$(S);_(f),j(ze=>{h=We(f,1,"",null,h,ze),A(O,`${c(P)??""} `),A(Q,` / ${y()/60}s`)},[()=>({"text-green-500":c(P)>0,"text-red-500":c(P)<0})]),E(q,f)};k(T,q=>{c(o)!==s()&&c(P)!==0&&q(K)})}E(l,I)});var Te=$(de,2);{var Ve=l=>{var o=vt();o.__click=[ut,d],E(l,o)};k(Te,l=>{Object.keys(pe()).length>0&&l(Ve)})}_(oe),_(ie),j(()=>A(Me,`in ${y()/60}s`)),E(m,se),Ie(),t()}Ze(["click"]);function $t(m,d){he(d,!0);let e=new te(d.data.recipeId);fe(m,{planner:e}),Ie()}export{$t as component,Et as universal};
