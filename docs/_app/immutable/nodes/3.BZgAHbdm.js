var Qe=Object.defineProperty;var Ye=(m,d,e)=>d in m?Qe(m,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[d]=e;var v=(m,d,e)=>Ye(m,typeof d!="symbol"?d+"":d,e);import{t as N,a as E,d as Fe,c as Ge}from"../chunks/CMY6Seje.js";import{L as he,O as le,u as U,M as W,V as q,N as Ie,g as c,Q as x,R as _,T as $,s as ce,P as He}from"../chunks/CsWNy0iH.js";import{D as u,e as X,i as Z,r as Je,c as Ke,f as ue,b as Ue,I as We,s as Xe}from"../chunks/D_JoGUew.js";import{w as D,d as p,r as Ze,g as ve}from"../chunks/DXt3pFxg.js";import{d as et,s as A}from"../chunks/Cvr2toEO.js";import{p as me,i as k}from"../chunks/_W78yxqw.js";import{s as b,a as tt}from"../chunks/BmRxifk-.js";const rt=({params:m})=>{console.log(m);const{id:d}=m,e=Number(d);return console.log(e),{recipeId:e}},Pt=Object.freeze(Object.defineProperty({__proto__:null,load:rt},Symbol.toStringTag,{value:"Module"}));class st{constructor(d,e,t,n){this.recipeId=d,this.itemId=e,this.targetAmount=t,this.targetInterval=n}}const ee=(m,d)=>{const e={...m};return Object.entries(d).forEach(([t,n])=>{const r=Number(t);e[r]=n}),e};class te extends st{constructor(e,t,n,r){var M;const s=!!(t&&(u.canBeExtracted[t]||u.canBeMined[t]));!e&&!s&&(e=(M=u.alternativeRecipe[t])==null?void 0:M[0]);const a=D(e),i=e?u.recipe[e]:void 0;let g=i==null?void 0:i.Results.findIndex(w=>t===w);const R=!t;!t&&(g??-1)>=0&&(t=i==null?void 0:i.Results[g??0]);const B=D(t),y=D((i==null?void 0:i.ResultCounts[g??0])??1),V=n?p([B,n],([w,z])=>z[w]):y;r||(r=Ze(i==null?void 0:i.TimeSpend));super(a,B,V,r);v(this,"amountEditable");v(this,"manualAmount",D());v(this,"children",D([]));v(this,"canBeMined",p(this.itemId,e=>u.canBeMined[e]));v(this,"canBeExtracted",p(this.itemId,e=>u.canBeExtracted[e]));v(this,"item",p(this.itemId,e=>u.item[e]));v(this,"recipe",p(this.recipeId,e=>u.recipe[e]));v(this,"options",p(this.itemId,e=>u.alternativeRecipe[e]));v(this,"relativeSpeed",p([this.targetInterval,this.recipe],([e,t])=>e/(t==null?void 0:t.TimeSpend)));v(this,"requiredBuildings",p([this.targetAmount,this.recipe,this.itemId,this.relativeSpeed],([e,t,n,r])=>{const s=t==null?void 0:t.Results.findIndex(i=>n===i),a=e/(t==null?void 0:t.ResultCounts[s])/r;return isNaN(a)?e:a}));v(this,"providedItemsPerInterval",p([this.recipe,this.relativeSpeed,this.requiredBuildings,this.itemId,this.targetAmount],([e,t,n,r,s])=>{if(!e&&r)return{[r]:s};const a={};return e==null||e.Results.forEach((i,g)=>{a[i]=e.ResultCounts[g]*t*n}),a}));v(this,"childrenProvideItemsPerInterval",p(this.children,(e,t)=>{const n=new Array(e.length),r=e.map((a,i)=>a.providedItemsPerInterval.subscribe(g=>{n[i]=g;const R=n.filter(B=>!!B).reduce((B,y)=>ee(B,y),{});t(R)})),s=n.filter(a=>!!a).reduce((a,i)=>ee(a,i),{});return t(s),()=>r.forEach(a=>a())}));v(this,"requiredItemsPerInterval",p([this.recipe,this.relativeSpeed,this.requiredBuildings],([e,t,n])=>{const r={};return e==null||e.Items.forEach((s,a)=>r[s]=e.ItemCounts[a]*t*n),r}));v(this,"inputsOutputs",p([this.childrenProvideItemsPerInterval,this.requiredItemsPerInterval,this.providedItemsPerInterval],([e,t,n])=>{const r=new Set;return Object.keys(t).forEach(s=>{r.add(Number(s))}),Object.keys(e??{}).forEach(s=>{r.add(Number(s))}),Object.keys(n).forEach(s=>{r.add(Number(s))}),r}));v(this,"surplus",p([this.childrenProvideItemsPerInterval,this.requiredItemsPerInterval,this.providedItemsPerInterval,this.itemId],([e,t,n,r])=>{const s=ee(e,n);return Object.entries(t).forEach(([a,i])=>s[Number(a)]=(s[Number(a)]??0)-i),Object.entries(s).filter(([,a])=>a<=0).forEach(([a])=>delete s[Number(a)]),s}));v(this,"deficit",p([this.childrenProvideItemsPerInterval,this.requiredItemsPerInterval],([e,t])=>{const n={...e};return Object.entries(t).forEach(([r,s])=>n[Number(r)]=(n[Number(r)]??0)-s),Object.entries(n).filter(([,r])=>r>=0).forEach(([r])=>delete n[Number(r)]),Object.keys(n).forEach(r=>{var a;const s=Number(r);(a=u.producedVia[s])!=null&&a.length||delete n[s]}),n}));v(this,"totals",p([this.itemId,this.requiredBuildings,this.children],([e,t,n])=>{const r={};return r[e]=t,n.map(s=>s.totals).forEach(s=>{Object.entries(s).forEach(([a,i])=>{const g=Number(a);r[g]=(r[g]??0)+i})}),r}));this.amountEditable=R,this.manualAmount=y,n||this.children.set(this.dbd())}setAmount(e){this.manualAmount.set(e)}setRecipeId(e){this.recipeId.set(e),this.expand()}expand(){this.children.set(this.dbd())}dbd(){const e=[],t=ve(this.recipe);return t==null||t.Items.forEach((n,r)=>{var i;if(!((i=u.alternativeRecipe[n])!=null&&i.length))return;const s=new te(void 0,n,this.requiredItemsPerInterval,this.targetInterval);e.push(s);const a=ve(s.providedItemsPerInterval);Object.entries(a).forEach(([g,R])=>{})}),e}}var nt=N('<input type="number" class="w-12 text-right">'),at=N("<span> </span>"),it=N("<option>extraction/mining</option>"),ot=N("<option> </option>"),dt=N(" <select><!><!></select>",1),lt=N('<span class="flex-grow text-right w-12"> </span>'),ct=N("<li> <!> </li>"),ut=(m,d)=>d.planner.expand(),vt=N("<button>DRILL BABY DRILL</button>"),mt=N('<div class="flex gap-2 max-w-2xl"><div><!></div> <div><h5><!></h5></div> <span> </span> <!></div> <div class="ml-4"><div class="ml-4"></div></div> <div class="ml-4"><ul class="ml-4"><!> <!></ul></div>',1);function fe(m,d){he(d,!0);const[e,t]=tt(),n=()=>b($e,"$targetAmount",e),r=()=>b(re,"$recipeId",e),s=()=>b(be,"$itemId",e),a=()=>b(Ae,"$options",e),i=()=>b(_e,"$item",e),g=()=>b(ge,"$recipe",e),R=()=>b(xe,"$targetInterval",e),B=()=>b(Pe,"$requiredBuildings",e),y=()=>b(Ee,"$children",e),V=()=>b(je,"$inputsOutputs",e),M=()=>b(Oe,"$providedItemsPerInterval",e),w=()=>b(Be,"$childrenProvideItemsPerInterval",e),z=()=>b(Ne,"$requiredItemsPerInterval",e),pe=()=>b(qe,"$deficit",e);let{item:_e,itemId:be,recipe:ge,recipeId:re,targetInterval:xe,requiredBuildings:Pe,children:Ee,targetAmount:$e,childrenProvideItemsPerInterval:Be,providedItemsPerInterval:Oe,requiredItemsPerInterval:Ne,inputsOutputs:je,deficit:qe,options:Ae}=d.planner,L=le(me(n())),C=le(me(r()));U(()=>{d.planner.amountEditable&&n()!==c(L)&&d.planner.setAmount(c(L))}),U(()=>{c(C)!==r()&&d.planner.setRecipeId(c(C))}),U(()=>{console.log(r())});var se=mt(),Q=W(se),Y=x(Q),Re=x(Y);{var ye=l=>{var o=nt();Je(o),Ke(o,()=>c(L),I=>ce(L,I)),E(l,o)},ke=l=>{var o=at(),I=x(o,!0);_(o),q(()=>A(I,n())),E(l,o)};k(Re,l=>{d.planner.amountEditable?l(ye):l(ke,!1)})}_(Y);var F=$(Y,2),ne=x(F),we=x(ne);{var Se=l=>{var o=dt(),I=W(o),P=$(I),T=x(P);{var J=f=>{var h=it();h.value=(h.__value=void 0)==null?"":void 0,q(()=>ue(h,r()===void 0)),E(f,h)};k(T,f=>{(u.canBeExtracted[s()]||u.canBeMined[s()])&&f(J)})}var j=$(T);X(j,1,a,Z,(f,h)=>{var O=ot(),S={},K=x(O,!0);_(O),q(()=>{S!==(S=u.recipe[c(h)].ID)&&(O.value=(O.__value=u.recipe[c(h)].ID)==null?"":u.recipe[c(h)].ID),ue(O,re===u.recipe[c(h)].ID),A(K,u.recipe[c(h)].Name)}),E(f,O)}),_(P),q(()=>A(I,`${i().Name??""}: `)),Ue(P,()=>c(C),f=>ce(C,f)),E(l,o)},De=l=>{var o=Fe();q(()=>{var I;return A(o,(I=g())==null?void 0:I.Name)}),E(l,o)};k(we,l=>{s()&&(a().length>1||a().length>=1&&u.canBeExtracted[s()]||u.canBeMined[s()])?l(Se):l(De,!1)})}_(ne),_(F);var G=$(F,2),Me=x(G);_(G);var Le=$(G,2);{var Ce=l=>{var o=lt(),I=x(o,!0);_(o),q(P=>A(I,P),[()=>Math.round(B()*100)/100]),E(l,o)};k(Le,l=>{B()&&r()&&l(Ce)})}_(Q);var H=$(Q,2),ae=x(H);X(ae,5,y,Z,(l,o,I,P)=>{fe(l,{get planner(){return c(o)}})}),_(ae),_(H);var ie=$(H,2),oe=x(ie),de=x(oe);X(de,1,V,Z,(l,o)=>{var I=Ge();const P=He(()=>{var j,f,h;return(((j=M())==null?void 0:j[c(o)])??0)+(((f=w())==null?void 0:f[c(o)])??0)-(((h=z())==null?void 0:h[c(o)])??0)});var T=W(I);{var J=j=>{var f=ct();let h;var O=x(f),S=$(O);We(S,{get itemId(){return c(o)}});var K=$(S);_(f),q(ze=>{h=Xe(f,1,"",null,h,ze),A(O,`${c(P)??""} `),A(K,` / ${R()/60}s`)},[()=>({"text-green-500":c(P)>0,"text-red-500":c(P)<0})]),E(j,f)};k(T,j=>{c(o)!==s()&&c(P)!==0&&j(J)})}E(l,I)});var Te=$(de,2);{var Ve=l=>{var o=vt();o.__click=[ut,d],E(l,o)};k(Te,l=>{Object.keys(pe()).length>0&&l(Ve)})}_(oe),_(ie),q(()=>A(Me,`in ${R()/60}s`)),E(m,se),Ie(),t()}et(["click"]);function Et(m,d){he(d,!0);let e=new te(d.data.recipeId);fe(m,{planner:e}),Ie()}export{Et as component,Pt as universal};
